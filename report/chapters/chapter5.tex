% chapter 5
\chapter{Results Evaluation}
In this chapter we will discuss the results taken from the performance and feature analysis as well as problem analysis
defined in step 4 to 6 of the project methodology, followed by the recommendation as defined in step 7. In order to
be able to successfully run the test dataset and produce the desired results,
the LP models need to fulfill the requirements R1, R2, R3 and R6 stated in the requirements table. All of the models
that we have created here have fulfilled those requierements.

\section{Test Results}
The table below shows the results of models running on the test dataset.
\vspace{0.5cm}
\begin{table}[!ht]
\centering
\begin{tabular}{|l|l|l|l|}
\hline
\multicolumn{4}{|c|}{CVRP Models running T-VRP-9 (Best solution: 31.5)} \\ \hline
              & Gurobi         & or-tools       & Optaplanner    \\ \hline
No of Vehicles & 2               & 2              & 2             \\ \hline
Vehicle Capacity & 4               & 4              & 4             \\ \hline
Time          & \textless 1 s  & \textless 1 s  & \textless 1 s  \\ \hline
Distance      & 31.5           & 34.2           & 31.5           \\ \hline
\% Optimality & 100            & 92.1           & 100          \\ \hline
\end{tabular}
\caption{Results from CVRP models running T-VRP-9 dataset}
\label{test-table}
\end{table}

As seen on the table above, or-tools did not perform as well as the other LP tools. However, its solution is a valid one
and it is worth checking how it performs under the benchmark datasets.

\section{Performance and Feature Analysis of LP Tools}
As part of the requirement R8, we have conducted performance and feature analysis. The table below shows the results of performance analysis the three models. All of the vehicles in the benchmark datasets
has the capacity of 100.
\vspace{0.5cm}
\begin{table}[!ht]
\centering
\begin{tabular}{|l|l|l|l|l|l|l|}
\hline
                                                                                                                              & \multicolumn{6}{c|}{Models}                                                                                                                                      \\ \hline
\multirow{2}{*}{Datasets}                                                                                                     & \multicolumn{2}{l|}{Gurobi}                       & \multicolumn{2}{l|}{or-tools}                           & \multicolumn{2}{l|}{Optaplanner}                   \\ \cline{2-7}
                                                                                                                              & Time                    & Solution                & Time                          & Solution                & Time                     & Solution                \\ \hline
\multirow{4}{*}{\begin{tabular}[c]{@{}l@{}}Name: A-n32-k5\\ Best Solution: 784\\ No of Vehicles: 5\\ Customers: 31\end{tabular}}    & \multirow{4}{*}{5 mins} & \multirow{4}{*}{N.A}  & \multirow{4}{*}{\textless 1s} & \multirow{4}{*}{870.9}  & \multirow{4}{*}{11s}     & \multirow{4}{*}{787.1}  \\
                                                                                                                              &                         &                         &                               &                         &                          &                         \\
                                                                                                                              &                         &                         &                               &                         &                          &                         \\
                                                                                                                              &                         &                         &                               &                         &                          &                         \\ \hline
\multirow{4}{*}{\begin{tabular}[c]{@{}l@{}}Name: A-n44-k6\\ Best Solution: 937\\ No of Vehicles: 6\\ Customers: 43\end{tabular}}    & \multirow{4}{*}{5 mins} & \multirow{4}{*}{N.A}    & \multirow{4}{*}{\textless 1s} & \multirow{4}{*}{1013.8} & \multirow{4}{*}{37s}     & \multirow{4}{*}{938.8}  \\
                                                                                                                              &                         &                         &                               &                         &                          &                         \\
                                                                                                                              &                         &                         &                               &                         &                          &                         \\
                                                                                                                              &                         &                         &                               &                         &                          &                         \\ \hline
\multirow{4}{*}{\begin{tabular}[c]{@{}l@{}}Name: A-n53-k7\\ Best Solution: 1010 \\ No of Vehicles: 7\\ Customers: 52\end{tabular}}  & \multirow{4}{*}{5 mins} & \multirow{4}{*}{N.A}  & \multirow{4}{*}{\textless 1s} & \multirow{4}{*}{1119.2} & \multirow{4}{*}{1 m 6s}  & \multirow{4}{*}{1057.3} \\
                                                                                                                              &                         &                         &                               &                         &                          &                         \\
                                                                                                                              &                         &                         &                               &                         &                          &                         \\
                                                                                                                              &                         &                         &                               &                         &                          &                         \\ \hline
\multirow{4}{*}{\begin{tabular}[c]{@{}l@{}}Name: A-n65-k9\\ Best Solution: 1174\\ No of Vehicles: 9\\ Customers: 64\end{tabular}}   & \multirow{4}{*}{5 mins} & \multirow{4}{*}{N.A}   & \multirow{4}{*}{\textless 1s} & \multirow{4}{*}{1284}   & \multirow{4}{*}{1 m 24s} & \multirow{4}{*}{1187}   \\
                                                                                                                              &                         &                         &                               &                         &                          &                         \\
                                                                                                                              &                         &                         &                               &                         &                          &                         \\
                                                                                                                              &                         &                         &                               &                         &                          &                         \\ \hline
\multirow{4}{*}{\begin{tabular}[c]{@{}l@{}}Name: A-n80-k10\\ Best Solution: 1763\\ No of Vehicles: 10\\ Customers: 79\end{tabular}} & \multirow{4}{*}{5 mins} & \multirow{4}{*}{N.A} & \multirow{4}{*}{\textless 1s} & \multirow{4}{*}{1948.2} & \multirow{4}{*}{2 m}     & \multirow{4}{*}{1797.6} \\
                                                                                                                              &                         &                         &                               &                         &                          &                         \\
                                                                                                                              &                         &                         &                               &                         &                          &                         \\
                                                                                                                              &                         &                         &                               &                         &                          &                         \\ \hline
\end{tabular}
\caption{Performance Analysis Results}
\label{table:results}
\end{table}

None of the Gurobi models were able to give the optimal solution within 5 minutes. To roughly gauge the performance of Gurobi model,
we let its model running the A-n32-k5 dataset to run indefinitely. It stopped after 10 minutes and 30 seconds from the start and produces an optimal solution of
787.1, similar to the best solution by model implemented in Optaplanner. Based on this, we expect that the runtime of this model to take much longer time
when using datasets with higher loads with roughly similar solution to Optaplanner.

Despite performing well on the T-VRP-9, the solutions produced by the or-tools model are roughly
10\% less optimal than the known best solutions. Switching to other routing heuristics would either cause the model to run
 for indefinitely long time or produce a solution with no significant improvement.
There are a few heuristics and metaheuristics available, investigating how they perform with one another would be best for
another project. Using the right combination of heuristics and metaheuristics may improve the existing results.

Optaplanner performs rather well on the benchmark dataset, averaging at approximately 0.01\% less optimal than the best
known solutions. The Optaplanner model runs five minutes, but the optimal solution obtained does not change after
30 seconds to two minutes, depending on the dataset it is running on.

We also run the three models on the P-VRP-60 dataset to analyse how the models perform on the problem dataset with lower
load.  The results are tabulated in the table 5.3 and it clearly shows that Optaplanner has the best performance.
\vspace{0.5cm}
\begin{table}[!ht]
\centering
\begin{tabular}{|l|l|l|l|}
\hline
\multicolumn{4}{|c|}{CVRP Models running P-VRP-60} \\ \hline
              & Gurobi         & or-tools       & Optaplanner    \\ \hline
No of Vehicles & 5               & 5              & 5            \\ \hline
Vehicle Capacity & 15               & 15              & 15             \\ \hline
Time          & 1m 52s  & < 1s  & 1m 4s \\ \hline
Distance      & 3.1           & 10.5          & 2.9           \\ \hline
\end{tabular}
\caption{Results from CVRP models running P-VRP-9 dataset}
\label{p60-table}
\end{table}

The disparity of performance may be attributed to the implementation of the LP solver.
Gurobi uses Branch and bound method to solve MIP based problems \cite{gurobi:mip}, including VRP. Whereas
 Or-tools and Optaplanner uses heuristics approach to solve VRP and other planning based problems. As we have
  discussed in chapter 2, the choice of approach to solve the VRP instance will highly impact the time taken to compute it.

During the implementation of the LP models, we did feature analysis of the three LP tools mentioned in this project.
The results are tabulated in the table 5.4. Please note some of the attributes assigned to these features are subjective.
We assess activity of the user community through frequency of posts in google groups.

\begin{table}[!ht]
\centering
\begin{tabular}{|l|l|l|l|}
\hline
                      & Gurobi        & or-tools & Optaplanner \\ \hline
Ease of Modelling     & Moderate      &   Moderate      &    Easy    \\ \hline
Documentation         & Good         &  Incomplete   &   Good       \\ \hline
Examples              & Many        &  Many        &     Many        \\ \hline
Active Community      & Very Active  &  Active     &  Active        \\ \hline
Command line option   & Available            &  Available         &  Not available          \\ \hline
Programming Languages & >10               &    4      &    Java only         \\ \hline
Open source           &   No            &    Yes      &     Yes        \\ \hline
Cost                  &  Very high     &     Free     &       Free      \\ \hline
Performance           &  Good             &   Fair        &    Good         \\ \hline
Installation          &  Easy            &   Slightly difficult      &     Very easy        \\ \hline
GUI                   &  Not available             &   Not available        &  Not available            \\ \hline
Enterprise support     &  Available             &   Not available        &     Available        \\ \hline
\end{tabular}
\caption{Feature analysis of LP tools}
\label{feature-analysis}
\end{table}

Having completed both the performance and feature analysis, we have fulfilled the requirement R8.

Based on requirement R5, we must choose the LP model that performs well on both test and benchmark datasets. We have decided to use Optaplanner to analyse the problem given by the company. There are a few reasons
for this choice. Firstly, Optaplanner gives the best performance to solve CVRP instance based on the performance analysis
and the results of P-VRP-60 dataset.  Secondly, it is very practical and easy to model formulations using
this tool. Lastly, Gurobi and or-tools were impractical and inefficient to use given the circumstances of the project. Gurobi would take many hours
 to solve VRP with 226 customers and or-tools would produce very unsatisfactory solutions, based on its performance on P-VRP-60 and the benchmark datasets.

\section{Route Optimisation and Parameter Estimation}
Using Optaplanner, We have analysed the CVRP and CVRPTW models based on the formulation in chapter 3 and tabulated the results in
table 5.4. Both models have the following parameters:
\begin{itemize}
\item has 8 vehicles, with capacity of 29.
\item 226 customers and 1 depot.
\end{itemize}
\begin{table}[!ht]
\centering
\begin{tabular}{|l|l|l|l|}
\hline
Model  & Time Window & Solution & Actual Distance \\ \hline
CVRP   & No          & 10.27   & 798.57\\ \hline
CVRPTW & Yes         & 10.49   & 828.95\\ \hline
\end{tabular}
\caption{Optimisation results of VRP problem}
\label{my-label}
\end{table}

For CVRPTW model,the service time is set to 15 minutes and the earliest and latest time for delivery for all customers is set to 09:00 and 17:00 respectively, to fulfill
requirement R4. The actual distances are in kilometers and they were computed using the haversine function, which fulfills the requirement R9.

These are the routes of the two models are tabulated in figure the appendix section. The numbers represent the node number and
they are arranged in order of which customers get visited first. The node number may be translated into post code by referring
to the node to post code table in the appendix section. In addition, the route visualisations are also included in appendix D.2.
With those results, we have fulfilled the requirements R7 and R10.

To obtain the best solution, we need to estimate the number of vehicles and their maximum capacity.
We have estimated them by trial and error. There are 227 nodes in total, so the minimum number of edges to traverse
 all of the vertices once is 227. We try using different combinations of number of vehicles and vehicle capacity, such that their product
 is close to 227. We start by using more vehicles and low capacity. As we use lesser amount of vehicles and higher
  capacity, the total distance gets lower. However, using very few vehicles with high capacity may
yield infeasible solution or yield similar results to when using higher number of vehicles with low capacity.
We found the optimum value for both the CVRP and CVRPTW models when we use 8 vehicles with 29 capacity.

\section{Accuracy of Analysis}
We have used air distance in our LP models that assumes that the every path from one vertex to another is straight.
The eucledian distance is rather arbitrary since we cannot really tell how far is that in the
real life. So, we use haversine function to get the actual distance in km based on the optimal routes produced.
Using the distances computed above would not accurately represent the actual distances on the roads in real life. Actual roads
 tend to have a few curves to accomodate the contours of the land. This issue
is unavoidable as we do not have sufficient traffic data.

\section{Recommendations}
Based on the analysis above, we make the following recommendations to client company:
\begin{enumerate}
\item The optimal solution to the given problem measured in euclidian distances are 10.27 and 10.49 for the CVRP and CVRPTW Model respectively.
Both models use 8 vehicles with 29 capacity. In kilometers, the optimal solution for CVRP model is 798.57 and 828.95 for the CVRPTW model.
The routes for both models are tabulated in table D.1 and D.2 available in appendix D. The figure in appendix C.1 may be used to translate
node number into customer post code location.
\item Optaplanner yields the best performance overall to solve given VRP problem. If time is not an issue, Gurobi may
be used instead. Gurobi would also be more preferrable to use as the client tackles more sophisticated VRP problems. Or-tools produce
suboptimal solutions to both benchmark and problem datasets. This tool may be good for experimentation and learning purposes.
\end{enumerate}

\section{Review}
In this chapter we have shown the results of our analysis and made thorough discussion on them. Our analysis have met
all of the requirements stated in chapter 3. Based on the performance analysis, we found that only Optaplanner and Gurobi
produces optimal solutions to the given VRP instances. Or-tools
underperforms on all datasets except the test dataset. Due to practicality, we have decided to solve the given VRP problem using Optaplanner.
The optimal solution is found to be 10.27 and 10.49 for the CVRP and
CVRPTW model respectively, measured in eucledian distances. Both solutions were obtained with 8 vehicles and 29 capacity as the parameters.
In kilometers, the distances are 798.57 and 829.32 for the CVRP and
CVRPTW respectively. The routes of both models are tabulated in the tables available in appendix D. The accuracy of the model
is affected by the fact that real road distances were not used, which affects the actual optimal solution in real life.

We shall conclude and evaluate this project in the next chapter.